/******************************************************************************* * * 	AlterVision CMS Core - the Writer Club project * 	Created by AlterVision Creatives - www.altvis.ru *  Copyright © 2005-2010 AlterVision Creatives * * *  File: 			support.js *  Description:	Site support messages listing and automatic updates *  Author:			Anton 'AlterVision' Reznichenko - altervision13@gmail.com ********************************************************************************/var newstop = 0, newsbottom = 0;var updatetimer;var updateprogress = false;var moreprogress = false;// Automatic feed updatesfunction autoupdate () {	if ( updateprogress ) return false;	if ( updatetimer ) clearTimeout( updatetimer );	var aurl = loadlink + "?from=-" + newstop;	var proc = function( data ) {		$('#support').prepend( data );		updateprogress = false;		updatetimer = setTimeout( 'autoupdate()', 10000 );	};	$.ajax({ type: "GET", url: aurl, success: proc, dataType: "text" });	updateprogress = true;}// Load more newsfunction morenews () {	if ( moreprogress ) return false;	if (typeof( $('.sitemore').attr( 'class' ) ) == 'undefined' ) return false;	var aurl = loadlink + "?from=" + newsbottom;	var proc = function( data ) {		$('.siteload').hide();		$('#support').append( data );		moreprogress = false;	};	$.ajax({ type: "GET", url: aurl, success: proc, dataType: "text" });	$('.sitemore').attr( 'class', 'siteload' );	moreprogress = true;	return false;}// Set top and bottom newsfunction tbset ( bottom, top, messages ) {	if ( newstop < top ) newstop = top;	if ( newsbottom == 0 || newsbottom > bottom ) newsbottom = bottom;	if ( messages > 0 ) $("#suppnotify")[0].play();}// Automatics$(function(){	autoupdate();	$(window).scroll(function() {		if  ( $(window).scrollTop() >= $(document).height() - $(window).height() - 100 ) {			morenews();		}	});	$('#suppform').submit(function() {		var aurl = $('#suppform').attr( 'action' );		var pdat = $('#suppform').serialize();		var proc = function ( data ) {			$('#support-form').attr( 'class', 'minimal' );			$('#supptext').val( "" );			$('#supptext').removeProp( "disabled" );			$('#suppbutt').removeProp( "disabled" );			autoupdate();		}		var err = function () {			$('#supptext').removeProp( "disabled" );			$('#suppbutt').removeProp( "disabled" );		}		$('#supptext').prop( "disabled", true );		$('#suppbutt').prop( "disabled", true );		$.ajax({ type: "POST", url: aurl, success: proc, error: err, data: pdat, dataType: "text" });		return false;	});	$('#support-form').click(function() {		$('#support-form').attr( 'class', '' );	});});